<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>体成分分析仪 - 测量准备</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/controls.css">
    <link rel="stylesheet" href="css/gestures.css">
    <link rel="stylesheet" href="css/measure-guide.css">
</head>
<body class="bg-slate-50 text-slate-900 font-inter">
    <div class="screen-container" id="screen-container">
        <!-- 手势边缘区域 -->
        <div class="gesture-edge top" data-gesture="top"></div>
        <div class="gesture-edge left" data-gesture="left"></div>
        <div class="gesture-edge right" data-gesture="right"></div>
        
        <!-- 滑动指示器 -->
        <div class="swipe-indicator horizontal" id="swipe-indicator-horizontal"></div>
        
        <!-- 测量引导页 -->
        <div id="page-measure-guide" class="page active">
            <!-- 独立状态栏 -->
            <div class="measure-status-bar">
                <div class="status-time">11:29</div>
                <div class="status-right">
                    <svg class="bluetooth-icon" width="24" height="24" viewBox="0 0 24 24" fill="#2196F3">
                        <path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"/>
                    </svg>
                    <svg class="wifi-icon" width="24" height="24" viewBox="0 0 24 24" fill="#4CAF50">
                        <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/>
                    </svg>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="measure-main-content">
                <!-- 步骤指示器区域 -->
                <div class="measure-header">
                    <div class="step-indicator">
                        <div class="step-dot active"></div>
                        <div class="step-line"></div>
                        <div class="step-dot"></div>
                        <div class="step-line"></div>
                        <div class="step-dot"></div>
                    </div>
                    <div class="step-text">准备测量</div>
                    
                    <div class="user-badge" id="current-user-info">
                        <div class="user-avatar-mini">
                            <div class="avatar-circle-mini" id="user-avatar">华</div>
                        </div>
                        <span class="user-name-mini" id="current-user-name">华仔</span>
                    </div>
                </div>
                
                <!-- 可滚动内容区域 -->
                <div class="measure-content">
                <!-- 真实产品示意图 -->
                <div class="device-illustration">
                    <div class="measurement-diagram">
                        <div class="diagram-title">体成分测量示意图</div>
                        <div class="diagram-image">
                            <img src="images/body-analyzer-device.png" alt="LEPU体脂秤测量示意图" class="device-photo">
                            <div class="usage-instruction">
                                <div class="instruction-arrow left-arrow">赤脚站立</div>
                                <div class="instruction-arrow right-arrow">握紧手柄</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 保留原有的测量指引 -->
                <div class="measurement-instructions">
                    <h2 class="instruction-title">测量准备</h2>
                    <div class="instruction-list">
                        <div class="instruction-item">
                            <div class="instruction-number">1</div>
                            <div class="instruction-content">
                                <div class="instruction-text">脱下鞋袜，双脚站在金属电极上</div>
                                <div class="instruction-subtext">确保脚部完全接触电极片</div>
                            </div>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-number">2</div>
                            <div class="instruction-content">
                                <div class="instruction-text">双手握住手柄，手心接触电极</div>
                                <div class="instruction-subtext">保持手部干燥，紧握手柄</div>
                            </div>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-number">3</div>
                            <div class="instruction-content">
                                <div class="instruction-text">身体保持直立，双臂自然下垂</div>
                                <div class="instruction-subtext">测量过程中请勿移动</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 保留原有的注意事项 -->
                <div class="safety-notice">
                    <div class="notice-header">
                        <div class="notice-icon">⚠️</div>
                        <span class="notice-title">测量注意事项</span>
                    </div>
                    <div class="notice-content">
                        测量前2小时避免剧烈运动 • 测量前30分钟避免大量饮水
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部控制区域 - 固件交互模拟必需 -->
    <div class="control-area" id="control-area">
        <div class="control-btn-container">
            <button class="control-btn nav" onclick="goToIndex()">返回导航页</button>
            <button class="control-btn back" onclick="goBack()">返回</button>
            <button class="control-btn measure" onclick="startMeasuring()">模拟上秤</button>
        </div>
    </div>

    <script>
        function goBack() {
            window.location.href = 'main.html';
        }
        
        function goToIndex() {
            window.location.href = 'index.html';
        }
        
        function startMeasuring() {
            window.location.href = 'measure-progress.html';
        }
        
        // 添加快捷键支持
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                goBack();
            } else if (event.key === 'Enter' || event.key === ' ') {
                startMeasuring();
            }
        });
        
        // 页面加载时显示当前用户信息
        window.onload = function() {
            // 更新时间显示
            function updateTime() {
                const now = new Date();
                const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                                  now.getMinutes().toString().padStart(2, '0');
                const timeElement = document.getElementById('current-time');
                if (timeElement) {
                    timeElement.textContent = timeString;
                }
            }
            updateTime();
            setInterval(updateTime, 60000); // 每分钟更新一次
            
            // 尝试从localStorage获取测量数据
            const measurementData = localStorage.getItem('currentMeasurement');
            let userName = '华仔';
            let userAvatar = '华';
            let userColor = '#00d4ff';
            
            if (measurementData) {
                const data = JSON.parse(measurementData);
                userName = data.user || '华仔';
                // 设置用户头像和颜色
                switch(userName) {
                    case '华仔':
                        userAvatar = '华';
                        userColor = '#00d4ff';
                        break;
                    case '亦菲':
                        userAvatar = '亦';
                        userColor = '#db2777';
                        break;
                    case '志玲':
                        userAvatar = '志';
                        userColor = '#059669';
                        break;
                    case '访客':
                        userAvatar = 'G';
                        userColor = '#666666';
                        break;
                    default:
                        userAvatar = userName.substring(0, 1);
                        userColor = '#00d4ff';
                }
            }
            
            // 更新页面显示
            const nameElement = document.getElementById('current-user-name');
            const avatarElement = document.getElementById('user-avatar');
            
            if (nameElement) nameElement.textContent = userName;
            if (avatarElement) {
                avatarElement.textContent = userAvatar;
                avatarElement.style.background = userColor;
            }
        };

        // 实时时间更新功能
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const timeString = `${hours}:${minutes}`;
            
            const timeElement = document.querySelector('.status-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 立即更新一次时间
            updateTime();
            
            // 每分钟更新一次时间
            setInterval(updateTime, 60000);
            
            // 每秒检查一次，确保分钟变化时及时更新
            setInterval(function() {
                const now = new Date();
                if (now.getSeconds() === 0) {
                    updateTime();
                }
            }, 1000);
        });
    </script>
    <script src="js/gestures.js"></script>
</body>
</html>
